import streamlit as st
import random
from googletrans import Translator

# ----------------- Page Config ----------------- #
st.set_page_config(page_title="SwasthyaBot", page_icon="🩺", layout="centered")

# ----------------- Styles ----------------- #
st.markdown("""
    <style>
        html, body {
            background-color: #f5f5f5;
            color: #1f2937;
            font-family: 'Segoe UI', sans-serif;
        }
        .main {
            padding: 20px;
        }
        .stButton>button {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 0.6em 1.2em;
            border-radius: 10px;
        }
        .stTextInput>div>div>input {
            padding: 0.5em;
            border-radius: 6px;
        }
    </style>
""", unsafe_allow_html=True)

# ----------------- Translator ----------------- #
translator = Translator()

def translate(text, lang_code):
    try:
        return translator.translate(text, dest=lang_code).text
    except:
        return "Translation failed."

# ----------------- Branding ----------------- #
st.markdown("<h1 style='text-align: center; color: #4f46e5;'>🩺 SwasthyaBot</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center; font-size: 18px;'>AI-Powered Rural Health Diagnostic Chatbot</p>", unsafe_allow_html=True)
st.markdown("---")

# ----------------- Health Tip ----------------- #
tips = [
    "Stay hydrated 🥤", "Avoid junk food 🍔", "Wash hands 🧼",
    "Sleep 7+ hours 😴", "Eat fruits & veggies 🍎", "Exercise daily 🏃"
]
st.info(f"💡 Health Tip: {random.choice(tips)}")

# ----------------- Diagnosis Logic ----------------- #
def diagnose(symptoms):
    symptoms = [s.strip().lower() for s in symptoms]
    if "fever" in symptoms and "cough" in symptoms:
        return {"disease": "Flu", "advice": "Take rest and stay hydrated. Use paracetamol if needed."}
    elif "headache" in symptoms and "nausea" in symptoms:
        return {"disease": "Migraine", "advice": "Avoid light and noise. Rest and drink fluids."}
    elif "stomach pain" in symptoms:
        return {"disease": "Gastritis", "advice": "Avoid spicy foods. Drink plenty of water."}
    elif "fever" in symptoms:
        return {"disease": "Mild Viral", "advice": "Rest and monitor temperature."}
    else:
        return {"disease": "Unknown", "advice": "Consult a doctor for better diagnosis."}

# ----------------- Input Form ----------------- #
st.subheader("😷 Describe Your Symptoms")
st.markdown("Enter symptoms separated by commas (e.g., `fever, cough`)")

symptom_input = st.text_input("📝 Your Symptoms")
submit = st.button("🔍 Diagnose")

if submit and symptom_input:
    result = diagnose(symptom_input.split(','))
    st.success(f"🦠 Possible Condition: **{result['disease']}**")
    st.info(f"📌 Recommendation: {result['advice']}")

    # Translations
    st.markdown("---")
    st.markdown("🌐 **Translations**")
    st.markdown(f"👉 **Hindi:**\n- बीमारी: `{translate(result['disease'], 'hi')}`\n- सलाह: `{translate(result['advice'], 'hi')}`")
    st.markdown(f"👉 **Odia (ଓଡ଼ିଆ):**\n- ରୋଗ: `{translate(result['disease'], 'or')}`\n- ପରାମର୍ଶ: `{translate(result['advice'], 'or')}`")

    # Nearby Clinics
    st.markdown("---")
    st.subheader("🏥 Suggested Health Centers Nearby")
    centers = [
        {"name": "Gunupur CHC", "type": "Community Health Center"},
        {"name": "Rayagada DHH", "type": "District Headquarters Hospital"},
        {"name": "JK Pur Clinic", "type": "Private Clinic"},
        {"name": "Gunupur Private Hospital", "type": "Specialty Hospital"}
    ]
    for c in centers:
        st.markdown(f"🔹 **{c['name']}**  \n🏷️ {c['type']}")
